<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>common/ParameterBag.js - soundworks</title>
    
    <meta name="description" content="Documentation of soundworks, a full-stack JavaScript framework for distributed WebAudio and multimedia applications" />
    
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <link type="text/css" rel="stylesheet" href="styles/overrides.css">
    <script src="scripts/nav.js" defer></script>
    
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    <input type="text" id="nav-search" placeholder="Search" />
    
    
    
        <h2 class="home">
            <a href="index.html" style="background-image: url('./assets/logo-200x200.png')">
                Home
            </a>
        </h2>
    <h2><a href="http://soundworks.dev/" target="_blank" class="menu-item" >Website</a></h2><h2><a href="https://github.com/collective-soundworks/soundworks" target="_blank" class="menu-item" >Github</a></h2><h3>Classes</h3><ul><li><a href="Client.html">Client</a><ul class='members'><li data-type='member' style='display: none;'><a href="Client.html#config">config</a></li><li data-type='member' style='display: none;'><a href="Client.html#contextManager">contextManager</a></li><li data-type='member' style='display: none;'><a href="Client.html#id">id</a></li><li data-type='member' style='display: none;'><a href="Client.html#pluginManager">pluginManager</a></li><li data-type='member' style='display: none;'><a href="Client.html#role">role</a></li><li data-type='member' style='display: none;'><a href="Client.html#runtime">runtime</a></li><li data-type='member' style='display: none;'><a href="Client.html#socket">socket</a></li><li data-type='member' style='display: none;'><a href="Client.html#stateManager">stateManager</a></li><li data-type='member' style='display: none;'><a href="Client.html#status">status</a></li><li data-type='member' style='display: none;'><a href="Client.html#target">target</a></li><li data-type='member' style='display: none;'><a href="Client.html#token">token</a></li><li data-type='member' style='display: none;'><a href="Client.html#uuid">uuid</a></li><li data-type='member' style='display: none;'><a href="Client.html#version">version</a></li></ul><ul class='methods'><li data-type='method' style='display: none;'><a href="Client.html#getAuditState">getAuditState</a></li><li data-type='method' style='display: none;'><a href="Client.html#init">init</a></li><li data-type='method' style='display: none;'><a href="Client.html#onStatusChange">onStatusChange</a></li><li data-type='method' style='display: none;'><a href="Client.html#start">start</a></li><li data-type='method' style='display: none;'><a href="Client.html#stop">stop</a></li></ul></li><li><a href="ClientContext.html">ClientContext</a><ul class='members'><li data-type='member' style='display: none;'><a href="ClientContext.html#client">client</a></li><li data-type='member' style='display: none;'><a href="ClientContext.html#name">name</a></li><li data-type='member' style='display: none;'><a href="ClientContext.html#status">status</a></li></ul><ul class='methods'><li data-type='method' style='display: none;'><a href="ClientContext.html#enter">enter</a></li><li data-type='method' style='display: none;'><a href="ClientContext.html#exit">exit</a></li><li data-type='method' style='display: none;'><a href="ClientContext.html#start">start</a></li><li data-type='method' style='display: none;'><a href="ClientContext.html#stop">stop</a></li></ul></li><li><a href="ClientContextManager.html">ClientContextManager</a><ul class='methods'><li data-type='method' style='display: none;'><a href="ClientContextManager.html#get">get</a></li></ul></li><li><a href="ClientPlugin.html">ClientPlugin</a><ul class='members'><li data-type='member' style='display: none;'><a href="ClientPlugin.html#client">client</a></li><li data-type='member' style='display: none;'><a href="ClientPlugin.html#id">id</a></li><li data-type='member' style='display: none;'><a href="ClientPlugin.html#state">state</a></li><li data-type='member' style='display: none;'><a href="ClientPlugin.html#status">status</a></li><li data-type='member' style='display: none;'><a href="ClientPlugin.html#type">type</a></li></ul><ul class='methods'><li data-type='method' style='display: none;'><a href="ClientPlugin.html#onStateChange">onStateChange</a></li><li data-type='method' style='display: none;'><a href="ClientPlugin.html#propagateStateChange">propagateStateChange</a></li><li data-type='method' style='display: none;'><a href="ClientPlugin.html#start">start</a></li><li data-type='method' style='display: none;'><a href="ClientPlugin.html#stop">stop</a></li></ul></li><li><a href="ClientPluginManager.html">ClientPluginManager</a><ul class='members'><li data-type='member' style='display: none;'><a href="ClientPluginManager.html#status">status</a></li></ul><ul class='methods'><li data-type='method' style='display: none;'><a href="ClientPluginManager.html#addDependency">addDependency</a></li><li data-type='method' style='display: none;'><a href="ClientPluginManager.html#get">get</a></li><li data-type='method' style='display: none;'><a href="ClientPluginManager.html#getRegisteredPlugins">getRegisteredPlugins</a></li><li data-type='method' style='display: none;'><a href="ClientPluginManager.html#getUnsafe">getUnsafe</a></li><li data-type='method' style='display: none;'><a href="ClientPluginManager.html#onStateChange">onStateChange</a></li><li data-type='method' style='display: none;'><a href="ClientPluginManager.html#register">register</a></li></ul></li><li><a href="ClientSocket.html">ClientSocket</a><ul class='methods'><li data-type='method' style='display: none;'><a href="ClientSocket.html#addListener">addListener</a></li><li data-type='method' style='display: none;'><a href="ClientSocket.html#removeAllListeners">removeAllListeners</a></li><li data-type='method' style='display: none;'><a href="ClientSocket.html#removeListener">removeListener</a></li><li data-type='method' style='display: none;'><a href="ClientSocket.html#send">send</a></li></ul></li><li><a href="ClientStateManager.html">ClientStateManager</a><ul class='methods'><li data-type='method' style='display: none;'><a href="ClientStateManager.html#attach">attach</a></li><li data-type='method' style='display: none;'><a href="ClientStateManager.html#create">create</a></li><li data-type='method' style='display: none;'><a href="ClientStateManager.html#getClassDescription">getClassDescription</a></li><li data-type='method' style='display: none;'><a href="ClientStateManager.html#getCollection">getCollection</a></li><li data-type='method' style='display: none;'><a href="ClientStateManager.html#getSchema">getSchema</a></li><li data-type='method' style='display: none;'><a href="ClientStateManager.html#observe">observe</a></li><li data-type='method' style='display: none;'><a href="ClientStateManager.html#validateClassDescription">validateClassDescription</a></li></ul></li><li><a href="Server.html">Server</a><ul class='members'><li data-type='member' style='display: none;'><a href="Server.html#config">config</a></li><li data-type='member' style='display: none;'><a href="Server.html#contextManager">contextManager</a></li><li data-type='member' style='display: none;'><a href="Server.html#db">db</a></li><li data-type='member' style='display: none;'><a href="Server.html#httpServer">httpServer</a></li><li data-type='member' style='display: none;'><a href="Server.html#id">id</a></li><li data-type='member' style='display: none;'><a href="Server.html#pluginManager">pluginManager</a></li><li data-type='member' style='display: none;'><a href="Server.html#router">router</a></li><li data-type='member' style='display: none;'><a href="Server.html#sockets">sockets</a></li><li data-type='member' style='display: none;'><a href="Server.html#stateManager">stateManager</a></li><li data-type='member' style='display: none;'><a href="Server.html#status">status</a></li><li data-type='member' style='display: none;'><a href="Server.html#version">version</a></li></ul><ul class='methods'><li data-type='method' style='display: none;'><a href="Server.html#generateAuthToken">generateAuthToken</a></li><li data-type='method' style='display: none;'><a href="Server.html#getAuditState">getAuditState</a></li><li data-type='method' style='display: none;'><a href="Server.html#init">init</a></li><li data-type='method' style='display: none;'><a href="Server.html#isTrustedClient">isTrustedClient</a></li><li data-type='method' style='display: none;'><a href="Server.html#isTrustedToken">isTrustedToken</a></li><li data-type='method' style='display: none;'><a href="Server.html#onStatusChange">onStatusChange</a></li><li data-type='method' style='display: none;'><a href="Server.html#start">start</a></li><li data-type='method' style='display: none;'><a href="Server.html#stop">stop</a></li><li data-type='method' style='display: none;'><a href="Server.html#useDefaultApplicationTemplate">useDefaultApplicationTemplate</a></li></ul></li><li><a href="ServerClient.html">ServerClient</a><ul class='members'><li data-type='member' style='display: none;'><a href="ServerClient.html#id">id</a></li><li data-type='member' style='display: none;'><a href="ServerClient.html#role">role</a></li><li data-type='member' style='display: none;'><a href="ServerClient.html#socket">socket</a></li><li data-type='member' style='display: none;'><a href="ServerClient.html#uuid">uuid</a></li></ul></li><li><a href="ServerContext.html">ServerContext</a><ul class='members'><li data-type='member' style='display: none;'><a href="ServerContext.html#clients">clients</a></li><li data-type='member' style='display: none;'><a href="ServerContext.html#name">name</a></li><li data-type='member' style='display: none;'><a href="ServerContext.html#roles">roles</a></li><li data-type='member' style='display: none;'><a href="ServerContext.html#server">server</a></li><li data-type='member' style='display: none;'><a href="ServerContext.html#status">status</a></li></ul><ul class='methods'><li data-type='method' style='display: none;'><a href="ServerContext.html#enter">enter</a></li><li data-type='method' style='display: none;'><a href="ServerContext.html#exit">exit</a></li><li data-type='method' style='display: none;'><a href="ServerContext.html#start">start</a></li><li data-type='method' style='display: none;'><a href="ServerContext.html#stop">stop</a></li></ul></li><li><a href="ServerContextManager.html">ServerContextManager</a><ul class='methods'><li data-type='method' style='display: none;'><a href="ServerContextManager.html#get">get</a></li></ul></li><li><a href="ServerPlugin.html">ServerPlugin</a><ul class='members'><li data-type='member' style='display: none;'><a href="ServerPlugin.html#clients">clients</a></li><li data-type='member' style='display: none;'><a href="ServerPlugin.html#id">id</a></li><li data-type='member' style='display: none;'><a href="ServerPlugin.html#server">server</a></li><li data-type='member' style='display: none;'><a href="ServerPlugin.html#state">state</a></li><li data-type='member' style='display: none;'><a href="ServerPlugin.html#status">status</a></li><li data-type='member' style='display: none;'><a href="ServerPlugin.html#type">type</a></li></ul><ul class='methods'><li data-type='method' style='display: none;'><a href="ServerPlugin.html#addClient">addClient</a></li><li data-type='method' style='display: none;'><a href="ServerPlugin.html#onStateChange">onStateChange</a></li><li data-type='method' style='display: none;'><a href="ServerPlugin.html#propagateStateChange">propagateStateChange</a></li><li data-type='method' style='display: none;'><a href="ServerPlugin.html#removeClient">removeClient</a></li><li data-type='method' style='display: none;'><a href="ServerPlugin.html#start">start</a></li><li data-type='method' style='display: none;'><a href="ServerPlugin.html#stop">stop</a></li></ul></li><li><a href="ServerPluginManager.html">ServerPluginManager</a><ul class='members'><li data-type='member' style='display: none;'><a href="ServerPluginManager.html#status">status</a></li></ul><ul class='methods'><li data-type='method' style='display: none;'><a href="ServerPluginManager.html#addDependency">addDependency</a></li><li data-type='method' style='display: none;'><a href="ServerPluginManager.html#get">get</a></li><li data-type='method' style='display: none;'><a href="ServerPluginManager.html#getRegisteredPlugins">getRegisteredPlugins</a></li><li data-type='method' style='display: none;'><a href="ServerPluginManager.html#getUnsafe">getUnsafe</a></li><li data-type='method' style='display: none;'><a href="ServerPluginManager.html#onStateChange">onStateChange</a></li><li data-type='method' style='display: none;'><a href="ServerPluginManager.html#register">register</a></li></ul></li><li><a href="ServerSocket.html">ServerSocket</a><ul class='members'><li data-type='member' style='display: none;'><a href="ServerSocket.html#readyState">readyState</a></li><li data-type='member' style='display: none;'><a href="ServerSocket.html#sockets">sockets</a></li><li data-type='member' style='display: none;'><a href="ServerSocket.html#.ServerSocket">ServerSocket</a></li><li data-type='member' style='display: none;'><a href="ServerSocket.html#.ServerSocket">ServerSocket</a></li></ul><ul class='methods'><li data-type='method' style='display: none;'><a href="ServerSocket.html#addListener">addListener</a></li><li data-type='method' style='display: none;'><a href="ServerSocket.html#removeAllListeners">removeAllListeners</a></li><li data-type='method' style='display: none;'><a href="ServerSocket.html#removeListener">removeListener</a></li><li data-type='method' style='display: none;'><a href="ServerSocket.html#send">send</a></li></ul></li><li><a href="ServerSockets.html">ServerSockets</a></li><li><a href="ServerStateManager.html">ServerStateManager</a><ul class='methods'><li data-type='method' style='display: none;'><a href="ServerStateManager.html#attach">attach</a></li><li data-type='method' style='display: none;'><a href="ServerStateManager.html#create">create</a></li><li data-type='method' style='display: none;'><a href="ServerStateManager.html#defineClass">defineClass</a></li><li data-type='method' style='display: none;'><a href="ServerStateManager.html#deleteClass">deleteClass</a></li><li data-type='method' style='display: none;'><a href="ServerStateManager.html#deleteSchema">deleteSchema</a></li><li data-type='method' style='display: none;'><a href="ServerStateManager.html#getClassDescription">getClassDescription</a></li><li data-type='method' style='display: none;'><a href="ServerStateManager.html#getCollection">getCollection</a></li><li data-type='method' style='display: none;'><a href="ServerStateManager.html#getSchema">getSchema</a></li><li data-type='method' style='display: none;'><a href="ServerStateManager.html#isClassDefined">isClassDefined</a></li><li data-type='method' style='display: none;'><a href="ServerStateManager.html#observe">observe</a></li><li data-type='method' style='display: none;'><a href="ServerStateManager.html#registerCreateHook">registerCreateHook</a></li><li data-type='method' style='display: none;'><a href="ServerStateManager.html#registerDeleteHook">registerDeleteHook</a></li><li data-type='method' style='display: none;'><a href="ServerStateManager.html#registerSchema">registerSchema</a></li><li data-type='method' style='display: none;'><a href="ServerStateManager.html#registerUpdateHook">registerUpdateHook</a></li><li data-type='method' style='display: none;'><a href="ServerStateManager.html#validateClassDescription">validateClassDescription</a></li></ul></li><li><a href="SharedState.html">SharedState</a><ul class='members'><li data-type='member' style='display: none;'><a href="SharedState.html#className">className</a></li><li data-type='member' style='display: none;'><a href="SharedState.html#id">id</a></li><li data-type='member' style='display: none;'><a href="SharedState.html#isOwner">isOwner</a></li><li data-type='member' style='display: none;'><a href="SharedState.html#schemaName">schemaName</a></li></ul><ul class='methods'><li data-type='method' style='display: none;'><a href="SharedState.html#delete">delete</a></li><li data-type='method' style='display: none;'><a href="SharedState.html#detach">detach</a></li><li data-type='method' style='display: none;'><a href="SharedState.html#get">get</a></li><li data-type='method' style='display: none;'><a href="SharedState.html#getDefaults">getDefaults</a></li><li data-type='method' style='display: none;'><a href="SharedState.html#getDescription">getDescription</a></li><li data-type='method' style='display: none;'><a href="SharedState.html#getInitValues">getInitValues</a></li><li data-type='method' style='display: none;'><a href="SharedState.html#getSchema">getSchema</a></li><li data-type='method' style='display: none;'><a href="SharedState.html#getUnsafe">getUnsafe</a></li><li data-type='method' style='display: none;'><a href="SharedState.html#getValues">getValues</a></li><li data-type='method' style='display: none;'><a href="SharedState.html#getValuesUnsafe">getValuesUnsafe</a></li><li data-type='method' style='display: none;'><a href="SharedState.html#onDelete">onDelete</a></li><li data-type='method' style='display: none;'><a href="SharedState.html#onDetach">onDetach</a></li><li data-type='method' style='display: none;'><a href="SharedState.html#onUpdate">onUpdate</a></li><li data-type='method' style='display: none;'><a href="SharedState.html#set">set</a></li></ul></li><li><a href="SharedStateCollection.html">SharedStateCollection</a><ul class='members'><li data-type='member' style='display: none;'><a href="SharedStateCollection.html#className">className</a></li><li data-type='member' style='display: none;'><a href="SharedStateCollection.html#length">length</a></li><li data-type='member' style='display: none;'><a href="SharedStateCollection.html#schemaName">schemaName</a></li><li data-type='member' style='display: none;'><a href="SharedStateCollection.html#size">size</a></li></ul><ul class='methods'><li data-type='method' style='display: none;'><a href="SharedStateCollection.html#detach">detach</a></li><li data-type='method' style='display: none;'><a href="SharedStateCollection.html#filter">filter</a></li><li data-type='method' style='display: none;'><a href="SharedStateCollection.html#find">find</a></li><li data-type='method' style='display: none;'><a href="SharedStateCollection.html#forEach">forEach</a></li><li data-type='method' style='display: none;'><a href="SharedStateCollection.html#get">get</a></li><li data-type='method' style='display: none;'><a href="SharedStateCollection.html#getDefaults">getDefaults</a></li><li data-type='method' style='display: none;'><a href="SharedStateCollection.html#getDescription">getDescription</a></li><li data-type='method' style='display: none;'><a href="SharedStateCollection.html#getSchema">getSchema</a></li><li data-type='method' style='display: none;'><a href="SharedStateCollection.html#getUnsafe">getUnsafe</a></li><li data-type='method' style='display: none;'><a href="SharedStateCollection.html#getValues">getValues</a></li><li data-type='method' style='display: none;'><a href="SharedStateCollection.html#getValuesUnsafe">getValuesUnsafe</a></li><li data-type='method' style='display: none;'><a href="SharedStateCollection.html#map">map</a></li><li data-type='method' style='display: none;'><a href="SharedStateCollection.html#onAttach">onAttach</a></li><li data-type='method' style='display: none;'><a href="SharedStateCollection.html#onChange">onChange</a></li><li data-type='method' style='display: none;'><a href="SharedStateCollection.html#onDetach">onDetach</a></li><li data-type='method' style='display: none;'><a href="SharedStateCollection.html#onUpdate">onUpdate</a></li><li data-type='method' style='display: none;'><a href="SharedStateCollection.html#reduce">reduce</a></li><li data-type='method' style='display: none;'><a href="SharedStateCollection.html#set">set</a></li><li data-type='method' style='display: none;'><a href="SharedStateCollection.html#sort">sort</a></li></ul></li></ul><h3>Global</h3><ul>
                    <li>
                        <a href="global.html#ClientAppConfig">Types</a>
                        <ul>
                            <li><a href="global.html#ClientAppConfig">ClientAppConfig</a></li><li><a href="global.html#ClientConfig">ClientConfig</a></li><li><a href="global.html#ClientDescription">ClientDescription</a></li><li><a href="global.html#ClientEnvConfig">ClientEnvConfig</a></li><li><a href="global.html#ClientRole">ClientRole</a></li><li><a href="global.html#ServerAppConfig">ServerAppConfig</a></li><li><a href="global.html#ServerConfig">ServerConfig</a></li><li><a href="global.html#ServerEnvConfig">ServerEnvConfig</a></li><li><a href="global.html#SharedStateClassDescription">SharedStateClassDescription</a></li><li><a href="global.html#SharedStateClassName">SharedStateClassName</a></li><li><a href="global.html#SharedStateParameterDescription">SharedStateParameterDescription</a></li><li><a href="global.html#SharedStateParameterName">SharedStateParameterName</a></li>
                        </ul>
                    </li>
                
                    <li>
                        <a href="global.html#pluginDeleteOnStateChangeCallback">Callbacks</a>
                        <ul>
                            <li><a href="global.html#pluginDeleteOnStateChangeCallback">pluginDeleteOnStateChangeCallback</a></li><li><a href="global.html#pluginManagerDeleteOnStateChangeCallback">pluginManagerDeleteOnStateChangeCallback</a></li><li><a href="global.html#pluginManagerOnStateChangeCallback">pluginManagerOnStateChangeCallback</a></li><li><a href="global.html#pluginOnStateChangeCallback">pluginOnStateChangeCallback</a></li><li><a href="global.html#serverStateManagerCreateHook">serverStateManagerCreateHook</a></li><li><a href="global.html#serverStateManagerDeleteHook">serverStateManagerDeleteHook</a></li><li><a href="global.html#serverStateManagerUpdateHook">serverStateManagerUpdateHook</a></li><li><a href="global.html#sharedStateCollectionDeleteOnAttachCallback">sharedStateCollectionDeleteOnAttachCallback</a></li><li><a href="global.html#sharedStateCollectionDeleteOnChangeCallback">sharedStateCollectionDeleteOnChangeCallback</a></li><li><a href="global.html#sharedStateCollectionDeleteOnDetachCallback">sharedStateCollectionDeleteOnDetachCallback</a></li><li><a href="global.html#sharedStateCollectionDeleteOnUpdateCallback">sharedStateCollectionDeleteOnUpdateCallback</a></li><li><a href="global.html#sharedStateCollectionOnAttachCallback">sharedStateCollectionOnAttachCallback</a></li><li><a href="global.html#sharedStateCollectionOnChangeCallback">sharedStateCollectionOnChangeCallback</a></li><li><a href="global.html#sharedStateCollectionOnDetachCallback">sharedStateCollectionOnDetachCallback</a></li><li><a href="global.html#sharedStateCollectionOnUpdateCallback">sharedStateCollectionOnUpdateCallback</a></li><li><a href="global.html#sharedStateDeleteOnUpdateCallback">sharedStateDeleteOnUpdateCallback</a></li><li><a href="global.html#sharedStateOnUpdateCallback">sharedStateOnUpdateCallback</a></li><li><a href="global.html#stateManagerDeleteObserveCallback">stateManagerDeleteObserveCallback</a></li><li><a href="global.html#stateManagerObserveCallback">stateManagerObserveCallback</a></li>
                        </ul>
                    </li>
                </ul>
    
</nav>

<div id="main">
    
    <h1 class="page-title">common/ParameterBag.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import cloneDeep from 'lodash/cloneDeep.js';
import equal from 'fast-deep-equal';

import {
  isPlainObject,
} from '@ircam/sc-utils';

export const sharedOptions = {
  nullable: false,
  event: false, // if event=true, nullable=true
  required: false, // if required=true, value si required in initialization values
  metas: {},
  filterChange: true,
  immediate: false,
  acknowledge: true,
};

export const types = {
  boolean: {
    required: ['default'],
    get defaultOptions() {
      return Object.assign(cloneDeep(sharedOptions), {});
    },
    coerceFunction: (name, def, value) => {
      if (typeof value !== 'boolean') {
        throw new TypeError(`Invalid value (${value}) for boolean parameter '${name}'`);
      }

      return value;
    },
  },
  string: {
    required: ['default'],
    get defaultOptions() {
      return Object.assign(cloneDeep(sharedOptions), {});
    },
    coerceFunction: (name, def, value) => {
      if (typeof value !== 'string') {
        throw new TypeError(`Invalid value (${value}) for string parameter '${name}'`);
      }

      return value;
    },
  },
  integer: {
    required: ['default'],
    get defaultOptions() {
      return Object.assign(cloneDeep(sharedOptions), {
        min: -Infinity,
        max: +Infinity,
      });
    },
    sanitizeDescription: (def) => {
      // sanitize `null` values in received description, this prevent a bug when
      // `min` and `max` are explicitly set to `±Infinity`, the description is stringified
      // when sent over the network and therefore Infinity is transformed to `null`
      //
      // JSON.parse({ a: Infinity });
      // > { "a": null }
      if (def.min === null) {
        def.min = -Infinity;
      }

      if (def.max === null) {
        def.max = Infinity;
      }

      return def;
    },
    coerceFunction: (name, def, value) => {
      if (!(typeof value === 'number' &amp;&amp; Math.floor(value) === value)) {
        throw new TypeError(`Invalid value (${value}) for integer parameter '${name}'`);
      }

      return Math.max(def.min, Math.min(def.max, value));
    },
  },
  float: {
    required: ['default'],
    get defaultOptions() {
      return Object.assign(cloneDeep(sharedOptions), {
        min: -Infinity,
        max: +Infinity,
      });
    },
    sanitizeDescription: (def) => {
      // sanitize `null` values in received description, this prevent a bug when
      // `min` and `max` are explicitly set to `±Infinity`, the description is stringified
      // when sent over the network and therefore Infinity is transformed to `null`
      //
      // JSON.parse({ a: Infinity });
      // > { "a": null }
      if (def.min === null) {
        def.min = -Infinity;
      }

      if (def.max === null) {
        def.max = Infinity;
      }

      return def;
    },
    coerceFunction: (name, def, value) => {
      if (typeof value !== 'number' || value !== value) { // reject NaN
        throw new TypeError(`Invalid value (${value}) for float parameter '${name}'`);
      }

      return Math.max(def.min, Math.min(def.max, value));
    },
  },
  enum: {
    required: ['default', 'list'],
    get defaultOptions() {
      return Object.assign(cloneDeep(sharedOptions), {});
    },
    coerceFunction: (name, def, value) => {
      if (def.list.indexOf(value) === -1) {
        throw new TypeError(`Invalid value (${value}) for enum parameter '${name}'`);
      }


      return value;
    },
  },
  any: {
    required: ['default'],
    get defaultOptions() {
      return Object.assign(cloneDeep(sharedOptions), {});
    },
    coerceFunction: (name, def, value) => {
      // no check as it can have any type...
      return value;
    },
  },
};


/** @private */
class ParameterBag {
  static validateDescription(description) {
    for (let name in description) {
      const def = description[name];

      if (!Object.prototype.hasOwnProperty.call(def, 'type')) {
        throw new TypeError(`Invalid ParameterDescription for param '${name}': 'type' key is required`);
      }

      if (!Object.prototype.hasOwnProperty.call(types, def.type)) {
        throw new TypeError(`Invalid ParameterDescription for param '${name}': type '${def.type}' is not a valid type`);
      }

      const required = types[def.type].required;

      required.forEach(key => {
        if ((def.event === true || def.required === true) &amp;&amp; key === 'default') {
          // do nothing:
          // - default is always null for `event` params
          // - default is always null for `required` params
          if ('default' in def &amp;&amp; def.default !== null) {
            throw new TypeError(`Invalid ParameterDescription for param ${name}: 'default' property is set and not null while the parameter definition is declared as 'event' or 'required'`);
          }
        } else if (!Object.prototype.hasOwnProperty.call(def, key)) {
          throw new TypeError(`Invalid ParameterDescription for param "${name}": property '${key}' key is required`);
        }
      });

      // check given default value if any
      if ('default' in def &amp;&amp; def.default !== null) {
        try {
          types[def.type].coerceFunction(name, def, def.default);
        } catch (err) {
          throw new TypeError(`Invalid ParameterDescription for param "${name}": ${err.message}`);
        }
      }
    }
  }

  static getFullDescription(description) {
    const fullDescription = cloneDeep(description);

    for (let [name, def] of Object.entries(fullDescription)) {
      if (types[def.type].sanitizeDescription) {
        def = types[def.type].sanitizeDescription(def);
      }

      const { defaultOptions } = types[def.type];
      def = Object.assign({}, defaultOptions, def);
      // if event property is set to true, the param must
      // be nullable and its default value is `undefined`
      if (def.event === true) {
        def.nullable = true;
        def.default = null;
      }

      if (def.required === true) {
        def.default = null;
      }

      fullDescription[name] = def;
    }

    return fullDescription;
  }

  #description = {};
  #values = {};

  constructor(description, initValues = {}) {
    if (!isPlainObject(description)) {
      throw new TypeError(`Cannot construct ParameterBag: argument 1 must be an object`);
    }

    ParameterBag.validateDescription(description);

    description = ParameterBag.getFullDescription(description);
    initValues = cloneDeep(initValues);

    // make sure initValues make sens according to the given description
    for (let name in initValues) {
      if (!Object.prototype.hasOwnProperty.call(description, name)) {
        throw new ReferenceError(`Invalid init value for parameter '${name}': Parameter does not exists`);
      }
    }

    for (let [name, def] of Object.entries(description)) {
      if (def.required === true) {
        // throw if value is not given in init values
        if (initValues[name] === undefined || initValues[name] === null) {
          throw new TypeError(`Invalid init value for required param "${name}": Init value must be defined`);
        }

        def.default = initValues[name];
      }

      let initValue;

      if (Object.prototype.hasOwnProperty.call(initValues, name)) {
        initValue = initValues[name];
      } else {
        initValue = def.default;
      }

      this.#description[name] = def;
      // coerce init value and store in definition
      const coercedInitValue = this.set(name, initValue)[0];
      this.#description[name].initValue = coercedInitValue;
      this.#values[name] = coercedInitValue;
    }
  }

  /**
   * Define if the parameter exists.
   *
   * @param {string} name - Name of the parameter.
   * @return {Boolean}
   */
  has(name) {
    return Object.prototype.hasOwnProperty.call(this.#description, name);
  }

  /**
   * Return values of all parameters as a flat object. If a parameter is of `any`
   * type, a deep copy is made.
   *
   * @return {object}
   */
  getValues() {
    let values = {};

    for (let name in this.#values) {
      values[name] = this.get(name);
    }

    return values;
  }

  /**
   * Return values of all parameters as a flat object. Similar to `getValues` but
   * returns a reference to the underlying value in case of `any` type. May be
   * useful if the underlying value is big (e.g. sensors recordings, etc.) and
   * deep cloning expensive. Be aware that if changes are made on the returned
   * object, the state of your application will become inconsistent.
   *
   * @return {object}
   */
  getValuesUnsafe() {
    let values = {};

    for (let name in this.#values) {
      values[name] = this.getUnsafe(name);
    }

    return values;
  }

  /**
   * Return the value of the given parameter. If the parameter is of `any` type,
   * a deep copy is returned.
   *
   * @param {string} name - Name of the parameter.
   * @return {Mixed} - Value of the parameter.
   */
  get(name) {
    if (!this.has(name)) {
      throw new ReferenceError(`Cannot get value of undefined parameter '${name}'`);
    }

    if (this.#description[name].type === 'any') {
      // we return a deep copy of the object as we don't want the client code to
      // be able to modify our underlying data.
      return cloneDeep(this.#values[name]);
    } else {
      return this.#values[name];
    }
  }

  /**
   * Similar to `get` but returns a reference to the underlying value in case of
   * `any` type. May be useful if the underlying value is big (e.g. sensors
   * recordings, etc.) and deep cloning expensive. Be aware that if changes are
   * made on the returned object, the state of your application will become
   * inconsistent.
   *
   * @param {string} name - Name of the parameter.
   * @return {Mixed} - Value of the parameter.
   */
  getUnsafe(name) {
    if (!this.has(name)) {
      throw new ReferenceError(`Cannot get value of undefined parameter '${name}'`);
    }

    return this.#values[name];
  }

  /**
   * Check that the value is valid according to the class definition and return it coerced.
   *
   * @param {String} name - Name of the parameter.
   * @param {Mixed} value - Value of the parameter.
   */
  coerceValue(name, value) {
    if (!this.has(name)) {
      throw new ReferenceError(`Cannot set value of undefined parameter "${name}"`);
    }

    const def = this.#description[name];

    if (value === null &amp;&amp; def.nullable === false) {
      throw new TypeError(`Invalid value for ${def.type} param "${name}": value is null and param is not nullable`);
    } else if (value === null &amp;&amp; def.nullable === true) {
      value = null;
    } else {
      const { coerceFunction } = types[def.type];
      value = coerceFunction(name, def, value);
    }

    return value;
  }

  /**
   * Set the value of a parameter. If the value of the parameter is updated
   * (aka if previous value is different from new value) all registered
   * callbacks are registered.
   *
   * @param {string} name - Name of the parameter.
   * @param {Mixed} value - Value of the parameter.
   * @return {Array} - [new value, updated flag].
   */
  set(name, value) {
    value = this.coerceValue(name, value);
    const currentValue = this.#values[name];
    const updated = !equal(currentValue, value);

    // we store a deep copy of the object as we don't want the client to be able
    // to modify our underlying data, which leads to unexpected behavior where the
    // deep equal check to returns true, and therefore the update is not triggered.
    // @see tests/common.state-manager.spec.js
    // 'should copy stored value for "any" type to have a predictable behavior'
    if (this.#description[name].type === 'any') {
      value = cloneDeep(value);
    }

    this.#values[name] = value;

    // return tuple so that the state manager can handle the `filterChange` option
    return [value, updated];
  }

  /**
   * Reset a parameter to its initialization values. Reset all parameters if no argument.
   * @note - prefer `state.set(state.getInitValues())`
   *         or     `state.set(state.getDefaultValues())`
   *
   * @param {string} [name=null] - Name of the parameter to reset.
   */
  // reset(name = null) {
  //   if (name !== null) {
  //     this._params[name] = this._initValues[name];
  //   } else {
  //     for (let name in this.params) {
  //       this._params[name].reset();
  //     }
  //   }
  // }

  /**
   * @return {object}
   */
  getDescription(name = null) {
    if (name === null) {
      return this.#description;
    }

    if (!this.has(name)) {
      throw new ReferenceError(`Cannot get description of undefined parameter "${name}"`);
    }

    return this.#description[name];
  }

  // return the default value, if initValue has been given, return init values
  getInitValues() {
    const initValues = {};

    for (let [name, def] of Object.entries(this.#description)) {
      initValues[name] = def.initValue;
    }

    return initValues;
  }

  // return the default value, if initValue has been given, return init values
  getDefaults() {
    const defaults = {};

    for (let [name, def] of Object.entries(this.#description)) {
      defaults[name] = def.default;
    }

    return defaults;
  }

  // @todo - should cache result
  getParamListByDescriptor(descriptorName, descriptorValue) {
    const result = [];

    for (let [name, def] of Object.entries(this.#description)) {
      if (def[descriptorName] === descriptorValue) {
        result.push(name);
      }
    }

    return result;
  }
}

export default ParameterBag;
</code></pre>
        </article>
    </section>





    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 4.0.5</a> on Tue Feb 10 2026 15:01:47 GMT+0000 (Coordinated Universal Time) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>

<script src="scripts/search.js" defer></script>


<script src="scripts/collapse.js" defer></script>


</body>
</html>
